@page "/products/{productId}/edit"
@inject NavigationManager NavigationManager
@inject IProductsClient ProductsClient
@inject IProductGroupsClient ProductGroupsClient
@inject IAttributesClient AttributesClient
@inject IDialogService DialogService
@inject ISnackbar Snackbar
@using System.ComponentModel.DataAnnotations
@using YourBrand.Catalog.Products
@using YourBrand.Catalog.Products.Attributes
@implements IDisposable

<AppPageTitle>Product</AppPageTitle>

@if (product is null)
{
    <span>Loading...</span>
}
else
{
    <AppPageTitle>@product.Name (@product.Id)</AppPageTitle>

    <MudText Typo="Typo.h3" Align="Align.Center" Class="mb-12">@product.Name</MudText>

    @*
    <MudButton StartIcon="@Icons.Material.Filled.Link" Color="Color.Primary" Link="@($"/products/{product.Id}")">
        View product
    </MudButton> *@

    @if(product.Parent is not null) 
    {
         <MudButton StartIcon="@Icons.Material.Filled.Link" Color="Color.Primary" Link="@($"/products/{product.Parent.Id}/edit")">
            Parent product
        </MudButton>
    }
        <MudGrid Class="pt-4 mb-8">
            <MudItem md="6">
                <MudImage Src="@product.Image" ObjectFit="ObjectFit.Cover" Height="200" Width="200" Alt="Örebro Slott"  Elevation="25" Class="rounded-lg" />

                <div>
                    <InputFile id="fileInput" OnChange="UploadFiles" hidden accept="*.jpg, *.jpeg, *.png" />

                    <MudButton HtmlTag="label" Color="Color.Secondary" StartIcon="@Icons.Filled.CloudUpload" for="fileInput">
                        Upload image
                    </MudButton>
                </div>
            </MudItem>
            <MudItem md="6">
                    <MudPaper Elevation="25" Class="pa-4">
                        <MudSelect T="ProductVisibility?" Label="Visibility" Variant="Variant.Outlined" Value="@product.Visibility"
                                   ValueChanged="async (e) => await UpdateVisibility((ProductVisibility?)e)"
                                   ToStringFunc="x => x?.ToString()" Class="mt-8">
                            @foreach (var item in Enum.GetValues<ProductVisibility>().Select(x =>
                                (ProductVisibility?)x))
                            {
                                <MudSelectItem Value="@item" />
                            }
                        </MudSelect>
                    </MudPaper>
            </MudItem>
        </MudGrid>

    <ProductAttributesView ProductId="@ProductId" HasVariants="product.HasVariants" ProductAttributes="product.Attributes.ToList().AsReadOnly()" />

    @if(product.HasVariants)
    {
        <ProductVariantsView ProductId="@ProductId" />
    }

    <ProductOptionsView ProductId="@ProductId" ProductOptions="product.Options.ToList().AsReadOnly()" />
} 